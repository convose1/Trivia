<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TechQuiz Pro - Multiplayer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    /* Dark gradient background */
    .gradient-bg { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); }
    /* Stronger shadow for dark surfaces */
    .card-shadow { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2); }
    /* Option cards */
    .option-card { transition: all 0.3s ease; cursor: pointer; background: #1e293b; border-color: #334155; }
    .option-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3); border-color: #6366f1; }
    .option-card.selected { border-color: #6366f1; background-color: #312e81; }
    .option-card.correct { border-color: #10b981; background-color: #064e3b; }
    .option-card.incorrect { border-color: #ef4444; background-color: #7f1d1d; }
    .fade-in { animation: fadeIn 0.5s ease-in; }
    @keyframes fadeIn { from {opacity:0; transform: translateY(10px);} to {opacity:1; transform: translateY(0);} }
    .progress-bar { transition: width 0.5s ease; }
    .pulse { animation: pulse 2s infinite; }
    @keyframes pulse { 0%{transform:scale(1);}50%{transform:scale(1.05);}100%{transform:scale(1);} }
    .timer { transition: all 0.3s ease; }
    .timer.warning { color:#f59e0b; }
    .timer.danger { color:#ef4444; }
    .timer-circle { stroke-dasharray: 283; stroke-dashoffset: 0; transform: rotate(-90deg); transform-origin:center; transition: stroke-dashoffset 1s linear; }
    /* Points feedback pop animation */
    .points-feedback { animation: pointsPop 0.6s ease-out; }
    @keyframes pointsPop { 0% { transform: scale(0); opacity: 0; } 50% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
    /* Leaderboard strip */
    .leaderboard-strip { position: fixed; left: 0; right: 0; bottom: 0; background: rgba(15,23,42,0.95); border-top: 1px solid #1f2937; backdrop-filter: blur(6px); }
    .avatar { width: 48px; height: 48px; border-radius: 9999px; object-fit: cover; }
    /* Score badge overlay */
    .avatar-wrap { position: relative; display: inline-block; }
    .score-badge { position: absolute; right: -6px; top: -6px; background-color: #6366f1; color: #fff; border-radius: 9999px; width: 24px; height: 24px; font-size: 12px; display: flex; align-items: center; justify-content: center; border: 2px solid #1e293b; }
    /* Celebration animation */
    .celebration-layer { position: absolute; inset: 0; pointer-events: none; overflow: hidden; }
    .celebrate-emoji { position: absolute; font-size: 24px; opacity: 0; animation: floatUp 1.2s ease-out forwards; }
    @keyframes floatUp { 0% { transform: translateY(20px) scale(0.6) rotate(0deg); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateY(-140px) scale(1) rotate(var(--rot, 20deg)); opacity: 0; } }
    .celebrate-burst { position: absolute; left:50%; top:50%; transform: translate(-50%, -50%); width: 0; height: 0; border-radius: 9999px; background: radial-gradient(circle, rgba(99,102,241,0.35) 0%, rgba(99,102,241,0.0) 60%); animation: burst 0.8s ease-out forwards; }
    @keyframes burst { 0% { width: 0; height: 0; opacity: 0.9; } 100% { width: 140%; height: 140%; opacity: 0; } }
    /* Custom select with consistent caret padding */
    .nice-select {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 20 20" fill="none" stroke="%236b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 8 10 12 14 8"/></svg>');
      background-repeat: no-repeat;
      background-position: right 12px center; /* move caret left */
      background-size: 16px 16px;
      padding-right: 2.5rem; /* room for caret */
    }
    /* Dark helpers */
    .dark-bg { background-color: #0f172a; }
    .dark-card { background-color: #1e293b; color: #e2e8f0; }
    .dark-input { background-color: #334155; color: #e2e8f0; border-color: #475569; }
    .dark-input:focus { border-color: #6366f1; background-color: #312e81; }
    .dark-text-secondary { color: #94a3b8; }
    .dark-button { background-color: #6366f1; color: #ffffff; }
    .dark-button:hover { background-color: #4f46e5; }
    .dark-button-secondary { background-color: #334155; color: #e2e8f0; }
    .dark-button-secondary:hover { background-color: #475569; }
    .dark-progress-bg { background-color: #334155; }
    .dark-option-label { background-color: #475569; color: #e2e8f0; }
  </style>
</head>
<body class="dark-bg min-h-screen">
  
  <!-- Lobby Screen -->
  <div id="lobbyScreen" class="min-h-screen gradient-bg flex items-center justify-center p-4">
    <div class="dark-card rounded-2xl card-shadow p-8 md:p-10 max-w-xl w-full">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-white mb-1">Lobby</h2>
        <p class="dark-text-secondary">Choose a topic and start when everyone is ready.</p>
      </div>
      <div class="grid md:grid-cols-2 gap-6 mb-6">
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Selected Topic</label>
          <select id="topicSelect" class="nice-select dark-input w-full pl-4 pr-10 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200 cursor-pointer"></select>
        </div>
        <div class="flex items-end">
          <button id="startGameBtn" type="button" onclick="window.triggerStartGame && window.triggerStartGame()" class="w-full dark-button text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-600 transform hover:scale-105 transition duration-200 cursor-pointer">Start Game</button>
        </div>
      </div>
      <div>
        <p class="text-sm dark-text-secondary mb-2">Participants</p>
        <div id="lobbyParticipants" class="flex items-center gap-3 flex-wrap"></div>
      </div>
    </div>
  </div>

  <!-- Quiz Screen -->
  <div id="quizScreen" class="hidden min-h-screen gradient-bg flex items-center justify-center p-4 pb-24">
    <div class="dark-card rounded-2xl card-shadow p-6 md:p-8 max-w-2xl w-full">
      

      <!-- Progress Bar -->
      <div class="mb-8">
        <div class="flex justify-between text-sm dark-text-secondary mb-2">
          <span>Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span></span>
          <span id="progressPercent">0%</span>
        </div>
        <div class="w-full dark-progress-bg rounded-full h-3">
          <div id="progressBar" class="progress-bar bg-indigo-500 h-3 rounded-full" style="width: 0%"></div>
        </div>
      </div>

      <!-- Timer -->
      <div class="flex justify-center mb-6">
        <div class="relative w-16 h-16">
          <svg class="w-full h-full" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" fill="none" stroke="#334155" stroke-width="8" />
            <circle id="timerCircle" class="timer-circle" cx="50" cy="50" r="45" fill="none" stroke="#6366f1" stroke-width="8" />
          </svg>
          <div class="absolute inset-0 flex items-center justify-center">
            <span id="timerText" class="text-lg font-bold text-white">10</span>
          </div>
        </div>
      </div>

      <!-- Question -->
      <div class="mb-8">
        <h2 id="questionText" class="text-xl md:text-2xl font-semibold text-white mb-6 fade-in"></h2>
        <div id="optionsContainer" class="space-y-3"></div>
      </div>

      <!-- Participants row (shown during questions) -->
      <div class="mt-6">
        <div id="quizParticipants" class="flex items-center gap-3 flex-wrap"></div>
      </div>

      <!-- Next state hint -->
      <div class="text-center text-sm dark-text-secondary" id="statusHint"></div>
    </div>
  </div>

  <!-- Results Screen -->
  <div id="resultsScreen" class="hidden min-h-screen gradient-bg flex items-center justify-center p-4 pb-24">
    <div class="dark-card rounded-2xl card-shadow p-8 md:p-12 max-w-2xl w-full fade-in relative overflow-hidden">
      <div id="celebrationLayer" class="celebration-layer hidden"></div>
      <div class="text-center mb-8">
        <i id="resultIcon" class="text-6xl mb-4"></i>
        <h2 id="resultTitle" class="text-3xl font-bold text-white mb-2">Round Complete!</h2>
        <p class="dark-text-secondary">Your Final Score</p>
        <p id="finalScore" class="text-4xl font-bold text-indigo-400 mt-2"></p>
      </div>

      <div class="grid md:grid-cols-2 gap-6 mb-6">
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Selected Topic</label>
          <select id="topicSelectResults" class="nice-select dark-input w-full pl-4 pr-10 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200 cursor-pointer"></select>
        </div>
        <div class="flex items-end">
          <button id="newGameBtn" class="w-full dark-button text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-600 transform hover:scale-105 transition duration-200">New Game</button>
        </div>
      </div>

      <div>
        <p class="text-sm dark-text-secondary mb-2">Participants</p>
        <div id="lobbyParticipantsResults" class="flex items-center gap-3 flex-wrap"></div>
      </div>
    </div>
  </div>

  

  <!-- Socket.IO client served by the server (avoids CDN integrity issues in dev) -->
  <script src="/socket.io/socket.io.js"></script>
  <script type="module" src="./main.js?v=dev-2"></script>
</body>
</html>
